R2_m1_e = sum_m1_e$r.squared
an_m1_e = anova(m1_e)
m1_e_cd = cooks.distance(m1_e)
num_inf_1 = sum(m1_e_cd > 1)
residualPlot(m1_e)
r_i = rstandard(m1_e)
car::qqPlot(r_i)
plot(r_i)
h_ii_m1_e = hatvalues(m1_e)
e1_e = m1_e$residuals
ms_res_m1_e = an_m1_e$`Mean Sq`[length(an_m1_e$`Mean Sq`)]
PRESS_m1_e= sum((e1_e/(1-h_ii_m1_e))^2)
SS_t_m1_e = sum(an_m1_e$`Sum Sq`)
R_2_pred_m1_e = 1-(PRESS_m1_e/SS_t_m1_e)
pred_m1_e_1 = matrix(c(1, 0, 0), nrow = 3)
pred_m1_e_2 = matrix(c(1, 1, 0), nrow = 3)
pred_m1_e_3 = matrix(c(1, 0, 1), nrow = 3)
pred_matrix_m1_e  = cbind(pred_m1_e_1,pred_m1_e_2,pred_m1_e_3)
y_hat_m1_e = t(t(beta_m1_e)%*%pred_matrix_m1_e)
df_pred_m1_e = data.frame(y_hat = y_hat_m1_e)
m1_e_p = length(beta_m1_e)
t_val_m1_e = qt(1-alpha/2, df = n-m1_e_p)
m1_e_XTX = t(X_m1_e)%*%X_m1_e
for (i in 1:nrow(df_pred_m1_e)) {
df_pred_m1_e$lower_limit_CI[i] = df_pred_m1_e$y_hat[i] - t_val_m1_e*sqrt(ms_res_m1_e*t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i])
df_pred_m1_e$upper_limit_CI[i] = df_pred_m1_e$y_hat[i] + t_val_m1_e*sqrt(ms_res_m1_e*t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i])
df_pred_m1_e$lower_limit_PI[i] = df_pred_m1_e$y_hat[i] - t_val_m1_e*sqrt(ms_res_m1_e*(1+t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i]))
df_pred_m1_e$upper_limit_PI[i] = df_pred_m1_e$y_hat[i] + t_val_m1_e*sqrt(ms_res_m1_e*(1+t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i]))
}
df_pred_m1_e
df_seatbelts$year = factor(df_seatbelts$year)
m2_e = lm(data = df_seatbelts,seatbelt~enforce+year,x=T)
X_m2_e = m2_e$x
sum_m2_e = summary(m2_e)
beta_m2_e = m2_e$coefficients
residualPlot(m2_e)
R2_m2_e = sum_m2_e$r.squared
an_m2_e = anova(m2_e)
m2_e_cd = cooks.distance(m2_e)
num_inf_1 = sum(m2_e_cd > 1)
residualPlot(m2_e)
r_i_m2_e = rstandard(m2_e)
car::qqPlot(r_i_m2_e)
plot(r_i_m2_e)
h_ii_m2_e = hatvalues(m2_e)
e2_e = m2_e$residuals
PRESS_m2_e= sum((e2_e/(1-h_ii_m2_e))^2)
SS_t_m2_e = sum(an_m2_e$`Sum Sq`)
R_2_pred_m2_e = 1-(PRESS_m2_e/SS_t_m2_e)
ss_r_m1_e = sum(an_m1_e$`Sum Sq`[-length(an_m1_e$`Sum Sq`)])
ss_r_m2_e = sum(an_m2_e$`Sum Sq`[-length(an_m2_e$`Sum Sq`)])
extra_sum_sq_yr = ss_r_m2_e - ss_r_m1_e
ms_res_m2_e = an_m2_e$`Mean Sq`[length(an_m2_e$`Mean Sq`)]
alpha = 0.05
dof_r_m2_e = length(beta_m2_e) - 1
dof_res_m2_e = n - dof_r_m2_e - 1
p_add = length(beta_m2_e) - length(beta_m1_e)
F_m2_e = (extra_sum_sq_yr/p_add)/ms_res_m2_e
F_crit_m2_e = qf(1-alpha,dof_r,dof_res)
reject_H0_m2_e = F_m2_e > F_crit_m2_e
m2_e_p = length(beta_m2_e)
sort(beta_m2_e)
pred_m2_e <- matrix(0, nrow = m2_e_p)
col_number_H <- which(colnames(X_m2_e) == "year1997")
pred_m2_e_1 = pred_m2_e
pred_m2_e_1[1:3, ] <- matrix(c(1, 1, 0))
pred_m2_e_1[col_number_H,] <- 1
col_number_M = which(colnames(X_m2_e) == "year1992")
pred_m2_e_2 = pred_m2_e
pred_m2_e_2[1:3, ] = matrix(c(1, 1, 0))
pred_m2_e_2[col_number_M,] <- 1
col_number_L = which(colnames(X_m2_e) == "year1984")
pred_m2_e_3 = pred_m2_e
pred_m2_e_3[1:3, ] = matrix(c(1, 1, 0))
pred_m2_e_3[col_number_L,] <- 1
pred_matrix_m2_e  = cbind(pred_m2_e_1,pred_m2_e_2,pred_m2_e_3)
y_hat_m2_e = t(t(beta_m2_e)%*%pred_matrix_m2_e)
df_pred_m2_e = data.frame(y_hat = y_hat_m2_e)
m2_e_p = length(beta_m2_e)
t_val_m2_e = qt(1-alpha/2, df = n-m2_e_p)
m2_e_XTX = t(X_m2_e)%*%X_m2_e
for (i in 1:nrow(df_pred_m2_e)) {
df_pred_m2_e$lower_limit_CI[i] = df_pred_m2_e$y_hat[i] - t_val_m2_e*sqrt(ms_res_m2_e*t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i])
df_pred_m2_e$upper_limit_CI[i] = df_pred_m2_e$y_hat[i] + t_val_m2_e*sqrt(ms_res_m2_e*t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i])
df_pred_m2_e$lower_limit_PI[i] = df_pred_m2_e$y_hat[i] - t_val_m2_e*sqrt(ms_res_m2_e*(1+t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i]))
df_pred_m2_e$upper_limit_PI[i] = df_pred_m2_e$y_hat[i] + t_val_m2_e*sqrt(ms_res_m2_e*(1+t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i]))
}
m3_e = lm(data = df_seatbelts,seatbelt~enforce+year+state,x=T)
X_m3_e = m3_e$x
sum_m3_e = summary(m3_e)
beta_m3_e = m3_e$coefficients
residualPlot(m3_e)
R2_m3_e = sum_m3_e$r.squared
an_m3_e = anova(m3_e)
m3_e_cd = cooks.distance(m3_e)
num_inf_m3_e = sum(m3_e_cd > 1)
residualPlot(m3_e)
r_i_m3_e = rstandard(m3_e)
car::qqPlot(r_i_m3_e)
plot(r_i_m3_e)
h_ii_m3_e = hatvalues(m3_e)
e3_e = m3_e$residuals
PRESS_m3_e= sum((e3_e/(1-h_ii_m3_e))^2)
SS_t_m3_e = sum(an_m3_e$`Sum Sq`)
R_2_pred_m3_e = 1-(PRESS_m3_e/SS_t_m3_e)
ss_r_m1_e = sum(an_m1_e$`Sum Sq`[-length(an_m1_e$`Sum Sq`)])
ss_r_m3_e = sum(an_m3_e$`Sum Sq`[-length(an_m3_e$`Sum Sq`)])
extra_sum_sq_state = ss_r_m3_e - ss_r_m2_e
ms_res_m3_e = an_m3_e$`Mean Sq`[length(an_m3_e$`Mean Sq`)]
alpha = 0.05
dof_r_m3_e = length(beta_m3_e) - 1
dof_res_m3_e = n - dof_r_m3_e - 1
p_add = length(beta_m3_e) - length(beta_m2_e)
F_m3_e = (extra_sum_sq_state/p_add)/ms_res_m3_e
F_crit_m3_e = qf(1-alpha,dof_r,dof_res)
reject_H0_m3_e = F_m3_e > F_crit_m3_e
m3_e_p = length(beta_m3_e)
pred_m3_e <- matrix(0, nrow = m3_e_p)
col_number_1992 <- which(colnames(X_m3_e) == "year1992")
col_number_H <- which(colnames(X_m3_e) == "stateHI")
pred_m3_e_1 = pred_m3_e
pred_m3_e_1[1:3, ] <- matrix(c(1, 1, 0))
pred_m3_e_1[col_number_1992,] <- 1
pred_m3_e_1[col_number_H,] <- 1
col_number_M <- which(colnames(X_m3_e) == c("stateDC"))
pred_m3_e_2 = pred_m3_e
pred_m3_e_2[1:3, ] = matrix(c(1, 1, 0))
pred_m3_e_2[col_number_1992,] <- 1
pred_m3_e_2[col_number_M,] <- 1
col_number_L <- which(colnames(X_m3_e) == c("stateMS"))
pred_m3_e_3 = pred_m3_e
pred_m3_e_3[1:3, ] = matrix(c(1, 1, 0))
pred_m3_e_3[col_number_1992,] <- 1
pred_m3_e_3[col_number_L,] <- 1
pred_matrix_m3_e  = cbind(pred_m3_e_1,pred_m3_e_2,pred_m3_e_3)
y_hat_m3_e = t(t(beta_m3_e)%*%pred_matrix_m3_e)
df_pred_m3_e = data.frame(y_hat = y_hat_m3_e)
m3_e_p = length(beta_m3_e)
t_val_m3_e = qt(1-alpha/2, df = n-m3_e_p)
m3_e_XTX = t(X_m3_e)%*%X_m3_e
for (i in 1:nrow(df_pred_m3_e)) {
df_pred_m3_e$lower_limit_CI[i] = df_pred_m3_e$y_hat[i] - t_val_m3_e*sqrt(ms_res_m3_e*t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i])
df_pred_m3_e$upper_limit_CI[i] = df_pred_m3_e$y_hat[i] + t_val_m3_e*sqrt(ms_res_m3_e*t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i])
df_pred_m3_e$lower_limit_PI[i] = df_pred_m3_e$y_hat[i] - t_val_m3_e*sqrt(ms_res_m3_e*(1+t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i]))
df_pred_m3_e$upper_limit_PI[i] = df_pred_m3_e$y_hat[i] + t_val_m3_e*sqrt(ms_res_m3_e*(1+t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i]))
}
m3_e = lm(data = df_seatbelts,seatbelt~enforce+year+state,x=T)
X_m3_e = m3_e$x
sum_m3_e = summary(m3_e)
beta_m3_e = m3_e$coefficients
residualPlot(m3_e)
R2_m3_e = sum_m3_e$r.squared
an_m3_e = anova(m3_e)
m3_e_cd = cooks.distance(m3_e)
num_inf_m3_e = sum(m3_e_cd > 1)
residualPlot(m3_e)
r_i_m3_e = rstandard(m3_e)
car::qqPlot(r_i_m3_e)
plot(r_i_m3_e)
h_ii_m3_e = hatvalues(m3_e)
e3_e = m3_e$residuals
PRESS_m3_e= sum((e3_e/(1-h_ii_m3_e))^2)
SS_t_m3_e = sum(an_m3_e$`Sum Sq`)
R_2_pred_m3_e = 1-(PRESS_m3_e/SS_t_m3_e)
ss_r_m1_e = sum(an_m1_e$`Sum Sq`[-length(an_m1_e$`Sum Sq`)])
ss_r_m3_e = sum(an_m3_e$`Sum Sq`[-length(an_m3_e$`Sum Sq`)])
extra_sum_sq_state = ss_r_m3_e - ss_r_m2_e
ms_res_m3_e = an_m3_e$`Mean Sq`[length(an_m3_e$`Mean Sq`)]
alpha = 0.05
dof_r_m3_e = length(beta_m3_e) - 1
dof_res_m3_e = n - dof_r_m3_e - 1
p_add = length(beta_m3_e) - length(beta_m2_e)
F_m3_e = (extra_sum_sq_state/p_add)/ms_res_m3_e
F_crit_m3_e = qf(1-alpha,dof_r,dof_res)
reject_H0_m3_e = F_m3_e > F_crit_m3_e
m3_e_p = length(beta_m3_e)
pred_m3_e <- matrix(0, nrow = m3_e_p)
col_number_1992 <- which(colnames(X_m3_e) == "year1992")
col_number_H <- which(colnames(X_m3_e) == "stateHI")
pred_m3_e_1 = pred_m3_e
pred_m3_e_1[1:3, ] <- matrix(c(1, 1, 0))
pred_m3_e_1[col_number_1992,] <- 1
pred_m3_e_1[col_number_H,] <- 1
col_number_M <- which(colnames(X_m3_e) == c("stateDC"))
pred_m3_e_2 = pred_m3_e
pred_m3_e_2[1:3, ] = matrix(c(1, 1, 0))
pred_m3_e_2[col_number_1992,] <- 1
pred_m3_e_2[col_number_M,] <- 1
col_number_L <- which(colnames(X_m3_e) == c("stateMS"))
pred_m3_e_3 = pred_m3_e
pred_m3_e_3[1:3, ] = matrix(c(1, 1, 0))
pred_m3_e_3[col_number_1992,] <- 1
pred_m3_e_3[col_number_L,] <- 1
pred_matrix_m3_e  = cbind(pred_m3_e_1,pred_m3_e_2,pred_m3_e_3)
y_hat_m3_e = t(t(beta_m3_e)%*%pred_matrix_m3_e)
df_pred_m3_e = data.frame(y_hat = y_hat_m3_e)
m3_e_p = length(beta_m3_e)
t_val_m3_e = qt(1-alpha/2, df = n-m3_e_p)
m3_e_XTX = t(X_m3_e)%*%X_m3_e
for (i in 1:nrow(df_pred_m3_e)) {
df_pred_m3_e$lower_limit_CI[i] = df_pred_m3_e$y_hat[i] - t_val_m3_e*sqrt(ms_res_m3_e*t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i])
df_pred_m3_e$upper_limit_CI[i] = df_pred_m3_e$y_hat[i] + t_val_m3_e*sqrt(ms_res_m3_e*t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i])
df_pred_m3_e$lower_limit_PI[i] = df_pred_m3_e$y_hat[i] - t_val_m3_e*sqrt(ms_res_m3_e*(1+t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i]))
df_pred_m3_e$upper_limit_PI[i] = df_pred_m3_e$y_hat[i] + t_val_m3_e*sqrt(ms_res_m3_e*(1+t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i]))
}
# IMPORTANT: You will need to point this toward your ~/ebs_265/assignments/week_01 directory
# knitr::opts_knit$set(root.dir = "/Users/jmearles/Library/Mobile Documents/com~apple~CloudDocs/Documents/ucd/courses/ebs_265/assignments/midterm", echo = FALSE)
library(olsrr)
library(car)
df_seatbelts = read.csv("seatbelts.csv")
plot(df_seatbelts$seatbelt, df_seatbelts$fatalities,
xlab = "Seatbelt Usage",
ylab = "Fatalities",
main = "Seatbelt Usage vs Fatalities")
m0 = lm(data = df_seatbelts,fatalities~seatbelt)
sb_coeff_m0 = m0$coefficients[2]
sum_m0 = summary(m0)
R2_m0 = round(sum_m0$r.squared,2)
an_m0 = anova(m0)
sb_se_m0 = sum_m0$coefficients[2,2]
m0_cd = cooks.distance(m0)
num_inf_1 = sum(m0_cd > 1)
residualPlot(m0)
r_i = rstandard(m0)
car::qqPlot(r_i)
plot(r_i)
h_ii_m0 = hatvalues(m0)
e0 = m0$residuals
PRESS_m0= sum((e0/(1-h_ii_m0))^2)
SS_t_m0 = sum(an_m0$`Sum Sq`)
R_2_pred_m0 = round(1-(PRESS_m0/SS_t_m0),2)
# IMPORTANT: You will need to point this toward your ~/ebs_265/assignments/week_01 directory
# knitr::opts_knit$set(root.dir = "/Users/jmearles/Library/Mobile Documents/com~apple~CloudDocs/Documents/ucd/courses/ebs_265/assignments/midterm", echo = FALSE)
library(olsrr)
library(car)
df_seatbelts = read.csv("seatbelts.csv")
plot(df_seatbelts$seatbelt, df_seatbelts$fatalities,
xlab = "Seatbelt Usage",
ylab = "Fatalities",
main = "Seatbelt Usage vs Fatalities")
m0 = lm(data = df_seatbelts,fatalities~seatbelt)
sb_coeff_m0 = m0$coefficients[2]
sum_m0 = summary(m0)
R2_m0 = round(sum_m0$r.squared,2)
an_m0 = anova(m0)
sb_se_m0 = sum_m0$coefficients[2,2]
m0_cd = cooks.distance(m0)
num_inf_1 = sum(m0_cd > 1)
residualPlot(m0)
r_i = rstandard(m0)
car::qqPlot(r_i)
plot(r_i)
h_ii_m0 = hatvalues(m0)
e0 = m0$residuals
PRESS_m0= sum((e0/(1-h_ii_m0))^2)
SS_t_m0 = sum(an_m0$`Sum Sq`)
R_2_pred_m0 = round(1-(PRESS_m0/SS_t_m0),2)
df_seatbelts$speed70 = factor(df_seatbelts$speed70)
df_seatbelts$alcohol = factor(df_seatbelts$alcohol)
df_seatbelts$drinkage = factor(df_seatbelts$drinkage)
m1 = lm(data = df_seatbelts,fatalities~seatbelt+speed70+alcohol+drinkage+age, x=T)
sb_coeff_m1 = m1$coefficients[2]
sum_m1 = summary(m1)
R2_m1 = sum_m1$r.squared
an_m1 = anova(m1)
sb_se_m1 = sum_m1$coefficients[2,2]
m1_cd = cooks.distance(m1)
num_inf_1 = sum(m1_cd > 1)
ci_betas = confint(m1)
residualPlot(m1)
r_i = rstandard(m1)
car::qqPlot(r_i)
plot(r_i)
h_ii_m1 = hatvalues(m1)
e1 = m1$residuals
PRESS_m1= sum((e1/(1-h_ii_m1))^2)
SS_t_m1 = sum(an_m1$`Sum Sq`)
R_2_pred_m1 = 1-(PRESS_m1/SS_t_m1)
ss_r_m0 = sum(an_m0$`Sum Sq`[-length(an_m0$`Sum Sq`)])
ss_r_m1 = sum(an_m1$`Sum Sq`[-length(an_m1$`Sum Sq`)])
extra_sum_sq = ss_r_m1 - ss_r_m0
ms_res_m1 = an_m1$`Mean Sq`[length(an_m1$`Mean Sq`)]
alpha = 0.05
n = dim(df_seatbelts)[1]
dof_r = 5
dof_res = n - dof_r - 1
F1 = (extra_sum_sq/4)/ms_res_m1
F_crit = qf(1-alpha,dof_r,dof_res)
reject_H1 = F1 > F_crit
m1_X = m1$x
m1_XTX = t(m1_X)%*%(m1_X)
m1_beta = m1$coefficients
summary(m1)
diff_coeff_seatbelt = round(((m0$coefficients[2] - m1$coefficients[2])/m0$coefficients[2])*100,1)
pred_1 = matrix(c(1, 0.5, 0, 0, 0, 33), nrow = 6)
pred_2 = matrix(c(1, 0.5, 1, 0, 0, 33), nrow = 6)
pred_3 = matrix(c(1, 0.5, 0, 1, 0, 33), nrow = 6)
pred_4 = matrix(c(1, 0.5, 0, 0, 1, 33), nrow = 6)
pred_5 = matrix(c(1, 0.5, 0, 0, 0, 34), nrow = 6)
pred_6 = matrix(c(1, 0.6, 0, 0, 0, 33), nrow = 6)
pred_matrix  = cbind(pred_1,pred_2,pred_3,pred_4,pred_5,pred_6)
y_hat = t(t(m1_beta)%*%pred_matrix)
df_pred = data.frame(y_hat = y_hat)
alpha = 0.05
m1_n = dim(df_seatbelts)[1]
m1_p = length(m1_beta)
t_val = qt(1-alpha/2, df = m1_n-m1_p-1)
for (i in 1:nrow(df_pred)) {
df_pred$lower_limit_CI[i] = df_pred$y_hat[i] - t_val*sqrt(ms_res_m1*t(pred_matrix[,i])%*%solve(m1_XTX)%*%pred_matrix[,i])
df_pred$upper_limit_CI[i] = df_pred$y_hat[i] + t_val*sqrt(ms_res_m1*t(pred_matrix[,i])%*%solve(m1_XTX)%*%pred_matrix[,i])
df_pred$lower_limit_PI[i] = df_pred$y_hat[i] - t_val*sqrt(ms_res_m1*(1+t(pred_matrix[,i])%*%solve(m1_XTX)%*%pred_matrix[,i]))
df_pred$upper_limit_PI[i] = df_pred$y_hat[i] + t_val*sqrt(ms_res_m1*(1+t(pred_matrix[,i])%*%solve(m1_XTX)%*%pred_matrix[,i]))
}
knitr::kable(df_pred)
m2 = lm(data = df_seatbelts,fatalities~seatbelt+speed70+alcohol+drinkage+age+state, x=T)
m2_X = m2$x
diff_coeff_seatbelt_m3 = round(((m1$coefficients[2] - m2$coefficients[2])/m1$coefficients[2])*100,1)
m2_coeff_sorted = sort(m2$coefficients)
m2_beta = m2$coefficients
sb_coeff_m2 = m2_beta[2]
sum_m2 = summary(m2)
R2_m2 = sum_m2$r.squared
an_m2 = anova(m2)
ms_res_m2 = an_m2$`Mean Sq`[length(an_m2$`Mean Sq`)]
h_ii_m2 = hatvalues(m2)
e2 = m2$residuals
PRESS_m2= sum((e2/(1-h_ii_m2))^2)
SS_t_m2 = sum(an_m2$`Sum Sq`)
R_2_pred_m2 = 1-(PRESS_m2/SS_t_m2)
pred_m2 <- matrix(0, nrow = 56)
col_number_H <- which(colnames(m2_X) == "stateFL")
beta_h = m2_beta[col_number_H]
pred_1_m2 = pred_m2
pred_1_m2[1:6, ] <- matrix(c(1, 0.5, 0, 1, 0, 33))
pred_1_m2[col_number_H,] <- 1
col_number_M = which(colnames(m2_X) == "stateNE")
beta_m = m2_beta[col_number_M]
pred_2_m2 = pred_m2
pred_2_m2[1:6, ] = matrix(c(1, 0.5, 0, 1, 0, 33))
pred_2_m2[col_number_M,] <- 1
col_number_L = which(colnames(m2_X) == "stateUT")
beta_l = m2_beta[col_number_L]
pred_3_m2 = pred_m2
pred_3_m2[1:6, ] = matrix(c(1, 0.5, 0, 1, 0, 33))
pred_3_m2[col_number_L,] <- 1
pred_matrix_m2 = cbind(pred_1_m2,pred_2_m2,pred_3_m2)
y_hat_2 = t(t(m2_beta)%*%pred_matrix_m2)
df_pred_m2 = data.frame(y_hat = y_hat_2)
alpha = 0.05
m2_n = dim(df_seatbelts)[1]
m2_p = length(m2_beta)
t_val_m2 = qt(1-alpha/2, df = m1_n-m1_p)
m2_XTX = t(m2_X)%*%m2_X
for (i in 1:nrow(df_pred_m2)) {
df_pred_m2$lower_limit_CI[i] = df_pred_m2$y_hat[i] - t_val_m2*sqrt(ms_res_m2*t(pred_matrix_m2[,i])%*%solve(m2_XTX)%*%pred_matrix_m2[,i])
df_pred_m2$upper_limit_CI[i] = df_pred_m2$y_hat[i] + t_val_m2*sqrt(ms_res_m2*t(pred_matrix_m2[,i])%*%solve(m2_XTX)%*%pred_matrix_m2[,i])
df_pred_m2$lower_limit_PI[i] = df_pred_m2$y_hat[i] - t_val_m2*sqrt(ms_res_m2*(1+t(pred_matrix_m2[,i])%*%solve(m2_XTX)%*%pred_matrix_m2[,i]))
df_pred_m2$upper_limit_PI[i] = df_pred_m2$y_hat[i] + t_val_m2*sqrt(ms_res_m2*(1+t(pred_matrix_m2[,i])%*%solve(m2_XTX)%*%pred_matrix_m2[,i]))
}
m1_e = lm(data = df_seatbelts,seatbelt~enforce, x=T)
X_m1_e = m1_e$x
sum_m1_e = summary(m1_e)
beta_m1_e = m1_e$coefficients
residualPlot(m1_e)
R2_m1_e = sum_m1_e$r.squared
an_m1_e = anova(m1_e)
m1_e_cd = cooks.distance(m1_e)
num_inf_1 = sum(m1_e_cd > 1)
residualPlot(m1_e)
r_i = rstandard(m1_e)
car::qqPlot(r_i)
plot(r_i)
h_ii_m1_e = hatvalues(m1_e)
e1_e = m1_e$residuals
ms_res_m1_e = an_m1_e$`Mean Sq`[length(an_m1_e$`Mean Sq`)]
PRESS_m1_e= sum((e1_e/(1-h_ii_m1_e))^2)
SS_t_m1_e = sum(an_m1_e$`Sum Sq`)
R_2_pred_m1_e = 1-(PRESS_m1_e/SS_t_m1_e)
pred_m1_e_1 = matrix(c(1, 0, 0), nrow = 3)
pred_m1_e_2 = matrix(c(1, 1, 0), nrow = 3)
pred_m1_e_3 = matrix(c(1, 0, 1), nrow = 3)
pred_matrix_m1_e  = cbind(pred_m1_e_1,pred_m1_e_2,pred_m1_e_3)
y_hat_m1_e = t(t(beta_m1_e)%*%pred_matrix_m1_e)
df_pred_m1_e = data.frame(y_hat = y_hat_m1_e)
m1_e_p = length(beta_m1_e)
t_val_m1_e = qt(1-alpha/2, df = n-m1_e_p)
m1_e_XTX = t(X_m1_e)%*%X_m1_e
for (i in 1:nrow(df_pred_m1_e)) {
df_pred_m1_e$lower_limit_CI[i] = df_pred_m1_e$y_hat[i] - t_val_m1_e*sqrt(ms_res_m1_e*t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i])
df_pred_m1_e$upper_limit_CI[i] = df_pred_m1_e$y_hat[i] + t_val_m1_e*sqrt(ms_res_m1_e*t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i])
df_pred_m1_e$lower_limit_PI[i] = df_pred_m1_e$y_hat[i] - t_val_m1_e*sqrt(ms_res_m1_e*(1+t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i]))
df_pred_m1_e$upper_limit_PI[i] = df_pred_m1_e$y_hat[i] + t_val_m1_e*sqrt(ms_res_m1_e*(1+t(pred_matrix_m1_e[,i])%*%solve(m1_e_XTX)%*%pred_matrix_m1_e[,i]))
}
df_pred_m1_e
df_seatbelts$year = factor(df_seatbelts$year)
m2_e = lm(data = df_seatbelts,seatbelt~enforce+year,x=T)
X_m2_e = m2_e$x
sum_m2_e = summary(m2_e)
beta_m2_e = m2_e$coefficients
residualPlot(m2_e)
R2_m2_e = sum_m2_e$r.squared
an_m2_e = anova(m2_e)
m2_e_cd = cooks.distance(m2_e)
num_inf_1 = sum(m2_e_cd > 1)
residualPlot(m2_e)
r_i_m2_e = rstandard(m2_e)
car::qqPlot(r_i_m2_e)
plot(r_i_m2_e)
h_ii_m2_e = hatvalues(m2_e)
e2_e = m2_e$residuals
PRESS_m2_e= sum((e2_e/(1-h_ii_m2_e))^2)
SS_t_m2_e = sum(an_m2_e$`Sum Sq`)
R_2_pred_m2_e = 1-(PRESS_m2_e/SS_t_m2_e)
ss_r_m1_e = sum(an_m1_e$`Sum Sq`[-length(an_m1_e$`Sum Sq`)])
ss_r_m2_e = sum(an_m2_e$`Sum Sq`[-length(an_m2_e$`Sum Sq`)])
extra_sum_sq_yr = ss_r_m2_e - ss_r_m1_e
ms_res_m2_e = an_m2_e$`Mean Sq`[length(an_m2_e$`Mean Sq`)]
alpha = 0.05
dof_r_m2_e = length(beta_m2_e) - 1
dof_res_m2_e = n - dof_r_m2_e - 1
p_add = length(beta_m2_e) - length(beta_m1_e)
F_m2_e = (extra_sum_sq_yr/p_add)/ms_res_m2_e
F_crit_m2_e = qf(1-alpha,dof_r,dof_res)
reject_H0_m2_e = F_m2_e > F_crit_m2_e
m2_e_p = length(beta_m2_e)
sort(beta_m2_e)
pred_m2_e <- matrix(0, nrow = m2_e_p)
col_number_H <- which(colnames(X_m2_e) == "year1997")
pred_m2_e_1 = pred_m2_e
pred_m2_e_1[1:3, ] <- matrix(c(1, 1, 0))
pred_m2_e_1[col_number_H,] <- 1
col_number_M = which(colnames(X_m2_e) == "year1992")
pred_m2_e_2 = pred_m2_e
pred_m2_e_2[1:3, ] = matrix(c(1, 1, 0))
pred_m2_e_2[col_number_M,] <- 1
col_number_L = which(colnames(X_m2_e) == "year1984")
pred_m2_e_3 = pred_m2_e
pred_m2_e_3[1:3, ] = matrix(c(1, 1, 0))
pred_m2_e_3[col_number_L,] <- 1
pred_matrix_m2_e  = cbind(pred_m2_e_1,pred_m2_e_2,pred_m2_e_3)
y_hat_m2_e = t(t(beta_m2_e)%*%pred_matrix_m2_e)
df_pred_m2_e = data.frame(y_hat = y_hat_m2_e)
m2_e_p = length(beta_m2_e)
t_val_m2_e = qt(1-alpha/2, df = n-m2_e_p)
m2_e_XTX = t(X_m2_e)%*%X_m2_e
for (i in 1:nrow(df_pred_m2_e)) {
df_pred_m2_e$lower_limit_CI[i] = df_pred_m2_e$y_hat[i] - t_val_m2_e*sqrt(ms_res_m2_e*t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i])
df_pred_m2_e$upper_limit_CI[i] = df_pred_m2_e$y_hat[i] + t_val_m2_e*sqrt(ms_res_m2_e*t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i])
df_pred_m2_e$lower_limit_PI[i] = df_pred_m2_e$y_hat[i] - t_val_m2_e*sqrt(ms_res_m2_e*(1+t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i]))
df_pred_m2_e$upper_limit_PI[i] = df_pred_m2_e$y_hat[i] + t_val_m2_e*sqrt(ms_res_m2_e*(1+t(pred_matrix_m2_e[,i])%*%solve(m2_e_XTX)%*%pred_matrix_m2_e[,i]))
}
m3_e = lm(data = df_seatbelts,seatbelt~enforce+year+state,x=T)
X_m3_e = m3_e$x
sum_m3_e = summary(m3_e)
beta_m3_e = m3_e$coefficients
residualPlot(m3_e)
R2_m3_e = sum_m3_e$r.squared
an_m3_e = anova(m3_e)
m3_e_cd = cooks.distance(m3_e)
num_inf_m3_e = sum(m3_e_cd > 1)
residualPlot(m3_e)
r_i_m3_e = rstandard(m3_e)
car::qqPlot(r_i_m3_e)
plot(r_i_m3_e)
h_ii_m3_e = hatvalues(m3_e)
e3_e = m3_e$residuals
PRESS_m3_e= sum((e3_e/(1-h_ii_m3_e))^2)
SS_t_m3_e = sum(an_m3_e$`Sum Sq`)
R_2_pred_m3_e = 1-(PRESS_m3_e/SS_t_m3_e)
ss_r_m1_e = sum(an_m1_e$`Sum Sq`[-length(an_m1_e$`Sum Sq`)])
ss_r_m3_e = sum(an_m3_e$`Sum Sq`[-length(an_m3_e$`Sum Sq`)])
extra_sum_sq_state = ss_r_m3_e - ss_r_m2_e
ms_res_m3_e = an_m3_e$`Mean Sq`[length(an_m3_e$`Mean Sq`)]
alpha = 0.05
dof_r_m3_e = length(beta_m3_e) - 1
dof_res_m3_e = n - dof_r_m3_e - 1
p_add = length(beta_m3_e) - length(beta_m2_e)
F_m3_e = (extra_sum_sq_state/p_add)/ms_res_m3_e
F_crit_m3_e = qf(1-alpha,dof_r,dof_res)
reject_H0_m3_e = F_m3_e > F_crit_m3_e
m3_e_p = length(beta_m3_e)
pred_m3_e <- matrix(0, nrow = m3_e_p)
col_number_1992 <- which(colnames(X_m3_e) == "year1992")
col_number_H <- which(colnames(X_m3_e) == "stateHI")
pred_m3_e_1 = pred_m3_e
pred_m3_e_1[1:3, ] <- matrix(c(1, 1, 0))
pred_m3_e_1[col_number_1992,] <- 1
pred_m3_e_1[col_number_H,] <- 1
col_number_M <- which(colnames(X_m3_e) == c("stateDC"))
pred_m3_e_2 = pred_m3_e
pred_m3_e_2[1:3, ] = matrix(c(1, 1, 0))
pred_m3_e_2[col_number_1992,] <- 1
pred_m3_e_2[col_number_M,] <- 1
col_number_L <- which(colnames(X_m3_e) == c("stateMS"))
pred_m3_e_3 = pred_m3_e
pred_m3_e_3[1:3, ] = matrix(c(1, 1, 0))
pred_m3_e_3[col_number_1992,] <- 1
pred_m3_e_3[col_number_L,] <- 1
pred_matrix_m3_e  = cbind(pred_m3_e_1,pred_m3_e_2,pred_m3_e_3)
y_hat_m3_e = t(t(beta_m3_e)%*%pred_matrix_m3_e)
df_pred_m3_e = data.frame(y_hat = y_hat_m3_e)
m3_e_p = length(beta_m3_e)
t_val_m3_e = qt(1-alpha/2, df = n-m3_e_p)
m3_e_XTX = t(X_m3_e)%*%X_m3_e
for (i in 1:nrow(df_pred_m3_e)) {
df_pred_m3_e$lower_limit_CI[i] = df_pred_m3_e$y_hat[i] - t_val_m3_e*sqrt(ms_res_m3_e*t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i])
df_pred_m3_e$upper_limit_CI[i] = df_pred_m3_e$y_hat[i] + t_val_m3_e*sqrt(ms_res_m3_e*t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i])
df_pred_m3_e$lower_limit_PI[i] = df_pred_m3_e$y_hat[i] - t_val_m3_e*sqrt(ms_res_m3_e*(1+t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i]))
df_pred_m3_e$upper_limit_PI[i] = df_pred_m3_e$y_hat[i] + t_val_m3_e*sqrt(ms_res_m3_e*(1+t(pred_matrix_m3_e[,i])%*%solve(m3_e_XTX)%*%pred_matrix_m3_e[,i]))
}
shiny::runApp('C:/Users/ovais/git/IAC-Decarb-Tools/apps/fcft')
runApp('C:/Users/ovais/git/IAC-Decarb-Tools/apps/fcft')
